name: CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up CMake
      uses: lukka/get-cmake@latest

    - name: Set up Ninja
      uses: lukka/get-ninja@latest

    - name: Configure and build Chapter 1
      run: |
        cd chapters/chapter01/code
        mkdir build
        cd build
        cmake .. -G Ninja
        ninja

    - name: Configure and build Chapter 2 examples
      run: |
        cd chapters/chapter02/code
        Get-ChildItem -Directory | ForEach-Object {
          if (Test-Path "$($_.FullName)/CMakeLists.txt") {
            mkdir "$($_.FullName)/build" -Force
            cd "$($_.FullName)/build"
            cmake .. -G Ninja
            ninja
            cd ../../..
          }
        }
